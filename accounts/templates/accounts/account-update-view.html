{% extends "base.html" %}
{% load crispy_forms_tags %} 
{% load static %}
{% block content %}

<head>
<style type="text/css">

.change-ava{
  min-width:155px;
}


#trigger {
    visibility: hidden; 
    display: none; 
  } 



.col-form-label  {
  position: absolute;
  opacity: 0.5;
  color: gray;
  padding-left: calc(.375rem + 1px);
  padding-top: calc(.390rem + 2px);
  font-size: 14px;
}

input[type=text], input[type=email], select{
  padding-bottom: 3px !important;
  padding-top: 13px !important;
  padding-left: calc(.375rem + 1px) !important;
  font-size: 14px !important;
}

@media only screen and (max-width: 768px) {
  .col-form-label  {
    font-size: 13px;
  }
  .settings-btn {
    width: 100% !important;
  }
  .settings-container {
    width: 100% !important;
  }
}

</style>
</head>




<form action="" method="POST" role="form" enctype='multipart/form-data' class=''>
{% csrf_token %}
<div class='container settings-container' style="width:70%">
  <div class="row">

    <p class="col-12 text-center heading">Обновить инфу</p>
    <div class="col-12" style="padding-bottom: 1rem;">
      <div class="row">
        <div class="col-xs-6 col-md-4   text-center">
          {% if object.profile_foto %}
          <img src="{{ object.profile_foto.url }}"  class=" avatar  ml-2" alt="..." style="width:92px; height: 92px; margin-bottom: 1rem;">
          {% else %}
          <img src="{% static 'img/user_noname.png' %}" class="avatar"  style="width:92px; height: 92px; margin-bottom: 1rem;">
          {% endif %}
          {{form.user_form.profile_foto|as_crispy_field}} 
        </div>
        <div class="col-xs-6 col-md-4  ">
          {{form.user_form.username|as_crispy_field}}
          {{form.user_form.email|as_crispy_field}}
          <a href='{% url "password_change" %}' class="btn hover-button button-white medium-button" role="button" aria-pressed="true" style="margin-bottom: 1rem;">{{ password_btn }}</a>
        </div>
        <div class="col-xs-12 col-md-4  ">
          {{form.user_form.region|as_crispy_field}}
            <div style="padding-top: 0.5rem;">
              {{form.user_form.subscribed|as_crispy_field}}
            </div>
        </div>
      </div>
    </div>


{% if request.user.region.region_code == 'ua' %}

<p class="col-12 text-center heading" style="border-top: 1px solid gray; padding-top: 1rem;">Адрес</p>

<div class="col-12" style="padding-bottom: 1rem;">
  <div class="row">

    <div class="col-xs-12 col-md-6  ">
      <div class="row">
        <div class="col-12">
          {{form.address_form.city|as_crispy_field}}
        </div>  
      </div>
    </div>

    <div class="col-xs-12 col-md-6  ">
      <div class="row">
        <div class="col-12">
          {{form.address_form.post_office|as_crispy_field}}
        </div>  
      </div>
    </div>

    <div class="col-xs-12 col-md-6  ">
      <div class="row">
        <div class="col-12">
          {{form.address_form.name|as_crispy_field}}
        </div>   
      </div>
    </div>

    <div class="col-xs-12 col-md-6  ">
      <div class="row">
        <div class="col-12">
          {{form.address_form.name|as_crispy_field}}
        </div>   
      </div>
    </div>

  </div>
</div>


{% else %}

  <p class="col-12 text-center heading" style="border-top: 1px solid gray; padding-top: 1rem;">Адрес</p>

  <div class="col-12" style="padding-bottom: 1rem;">
    <div class="row">

      <div class="col-xs-12 col-md-6">
        <div class="row">

          <div class="col-12">
            {{form.address_form.name|as_crispy_field}}
          </div>        
        
          <div class="col-8">
            {{form.address_form.street|as_crispy_field}} 
          </div>       
       
          <div class="col-4">
            {{form.address_form.number|as_crispy_field}}
          </div>

        </div>
      </div>

      <div class="col-xs-12 col-md-6">
        <div class="row">

          <div class="col-12">
            {{form.address_form.additional_line|as_crispy_field}}
          </div>        
        
          <div class="col-8">
            {{form.address_form.city|as_crispy_field}} 
          </div>       
       
          <div class="col-4">
            {{form.address_form.postal_code|as_crispy_field}}
          </div>

        </div>
      </div>

      <div class="col-xs-12 col-md-6">
        <div class="row">

          <div class="col-12">
            {{form.address_form.country|as_crispy_field}}
          </div>  

        </div>
      </div>  


        
      <div class="col-xs-12 col-md-6">
        <div class="row">

          <div class="col-12">
            {{form.address_form.state|as_crispy_field}}
          </div>  
          
        </div>
      </div> 

      <div class="col-xs-12 col-md-6">
        <div class="row">

          <div class="col-12">
            {{form.address_form.post_office|as_crispy_field}}
          </div>  
          
        </div>
      </div> 

    </div>
  </div>

{% endif %}


  <!--previous version-->
    <!-- <div class="col-6 alert alert-primary">
      {{form.address_form.name|as_crispy_field}}
      {{form.address_form.additional_line|as_crispy_field}}
  </div>
    <div class="col-4 alert alert-primary">
      {{form.address_form.street|as_crispy_field}} 
      {{form.address_form.city|as_crispy_field}} 
    </div>
    <div class="col-2 alert alert-primary">
      {{form.address_form.number|as_crispy_field}}
      {{form.address_form.postal_code|as_crispy_field}} 
    </div>
    <div class="col-6 alert alert-primary">
      {{form.address_form.state|as_crispy_field}}
      {{form.address_form.country|as_crispy_field}} 
      </div>
    <div class="col-6 alert alert-primary">
      {{form.address_form.post_office|as_crispy_field}} 
       </div> -->
    <div class="col-12 text-center" style="border-top: 1px solid gray; padding-top: 1rem;">
        <button type="submit" class="mt-3 btn button-black hover-button large-button btn-block settings-btn" style='width:50%'>{{ save_btn }}</button>
        <a href='{% url "logout" %}' class="mt-3 btn btn-outline-danger hover-button large-button btn-block settings-btn" style='width:50%' role="button" aria-pressed="true">{{ logout_btn }}</a>
    </div>

  </div>
</div>
</form>





<script>


// Labels, placeholders for forms
var inputs = ["#id_user_form-username", "#id_user_form-email", "#id_user_form-region", "#id_address_form-name", "#id_address_form-additional_line", "#id_address_form-street", "#id_address_form-city", "#id_address_form-number", "#id_address_form-postal_code", "#id_address_form-state", "#id_address_form-country", "#id_address_form-post_office"]

jQuery.each(inputs, function(index, item) {
    var item_val = $(item).val()
    var input_str = 'input'+item
    var css_small = {"font-size": "10px", "padding-top": "1px"}
    var css_big = {"font-size": "14px", "padding-top": "calc(.375rem + 1px)"}

    // for prefilled fields
    if (item_val){
      $("label[for='" + $(item).attr('id') + "']").css(css_small);
    }

    // on focus
    $(item).focus(function() {
      $("label[for='" + $(this).attr('id') + "']").css(css_small);
    });

    // if fields were touched
    $(item).blur(function() {
      var input_str_val = $(input_str).val()
      // if fields were filled out
      if ( input_str_val ) {
        $("label[for='" + $(this).attr('id') + "']").css(css_small);
      };
      // if fields were left blank
      if ( input_str_val == '' ) {
        $("label[for='" + $(this).attr('id') + "']").css(css_big);
      };

    });
});





  var currentPath = window.location.href
  if (currentPath.indexOf("details") != -1){

      var languageOption = $('#language').val()
      var avatar = $('.avatar-upload-button')
      console.log(languageOption)
      avatar.hide()
      avatar.parent().prepend('<label for="avatar_custom" class="bt  hover-button button-white medium-button m-0">' + avatar.attr('label_for_btn') + '</label>')
      $(".avatar-upload-button").change(function (){
          var fieldVal = event.target.files[0].name;
          if (fieldVal != undefined || fieldVal != ""){
            if ($(".filepath")[0]) {
              $(".filepath").text(fieldVal);
            }
            else{
              avatar.parent().append("<small><span class='filepath'>" + fieldVal + "</span></small>")
            }
          }
        });
  };

</script>

{% endblock %}



